<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Bumdes - Expenses Manager</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
        }
        body {
            background: #f5f7fa;
            padding: 16px;
            display: flex;
            justify-content: center;
        }
        .app-container {
            max-width: 1200px;
            width: 100%;
            background: white;
            border-radius: 28px 28px 0 0;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            font-size: 28px;
            font-weight: 800;
            color: #1e3c5c;
        }
        .header h2 {
            font-size: 18px;
            font-weight: 400;
            color: #2e7d32;
            margin: 4px 0 2px;
        }
        .header h3 {
            font-size: 16px;
            font-weight: 300;
            color: #546e7a;
        }
        .month-picker {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #e8f0fe;
            padding: 12px 20px;
            border-radius: 50px;
            margin: 20px 0 25px;
        }
        .month-picker label {
            font-weight: 600;
            color: #0d3b5e;
        }
        .month-picker select {
            padding: 8px 20px;
            border-radius: 30px;
            border: 1px solid #2e7d32;
            font-weight: 600;
            background: white;
            cursor: pointer;
        }
        .total-expenses {
            background: #1e3c5c;
            color: white;
            padding: 16px 24px;
            border-radius: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            font-size: 1.3rem;
            margin: 25px 0 20px;
        }
        .total-expenses span:last-child {
            background: #2e7d32;
            padding: 8px 30px;
            border-radius: 40px;
            font-size: 1.8rem;
        }
        .kategori-section {
            margin-bottom: 30px;
            border: 1px solid #c8e6c9;
            border-radius: 20px;
            overflow: hidden;
            background: #fafafa;
        }
        .kategori-header {
            background: #2e7d32;
            color: white;
            padding: 12px 20px;
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .kategori-header .kategori-total {
            background: #ffb74d;
            color: #1e3c5c;
            padding: 5px 20px;
            border-radius: 30px;
            font-size: 1rem;
        }
        .table-wrapper {
            overflow-x: auto;
            padding: 0 0 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
            font-size: 14px;
        }
        th {
            background: #c8e6c9;
            color: #1e3c5c;
            padding: 12px 6px;
            font-weight: 600;
            text-align: center;
        }
        td {
            padding: 10px 6px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        .aksi-btn {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        .btn-edit, .btn-hapus {
            border: none;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
        }
        .btn-edit {
            background: #ffa726;
            color: white;
        }
        .btn-edit:hover {
            background: #fb8c00;
        }
        .btn-hapus {
            background: #ef5350;
            color: white;
        }
        .btn-hapus:hover {
            background: #e53935;
        }
        .empty-row td {
            padding: 20px;
            color: #999;
            font-style: italic;
        }
        .form-panel {
            background: #e8f0fe;
            border-radius: 30px;
            padding: 24px;
            margin: 30px 0 20px;
            border: 2px solid #2e7d32;
        }
        .form-title {
            font-weight: 700;
            font-size: 1.5rem;
            color: #1e3c5c;
            margin-bottom: 20px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .form-group label {
            font-weight: 600;
            color: #0d3b5e;
        }
        .form-group input, .form-group select {
            padding: 12px 15px;
            border: 1px solid #b0bec5;
            border-radius: 40px;
            font-size: 14px;
            background: white;
        }
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        .btn-primary, .btn-secondary, .btn-print {
            padding: 12px 28px;
            border: none;
            border-radius: 40px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-primary {
            background: #2e7d32;
            color: white;
        }
        .btn-primary:hover {
            background: #1b5e20;
        }
        .btn-secondary {
            background: #b0bec5;
            color: #1e3c5c;
        }
        .btn-secondary:hover {
            background: #90a4ae;
        }
        .btn-print {
            background: #1565c0;
            color: white;
            margin-right: 10px;
        }
        .btn-print:hover {
            background: #0d47a1;
        }
        .month-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin: 30px 0 15px;
            padding: 10px;
            background: #cfd8dc;
            border-radius: 50px;
        }
        .month-item {
            background: white;
            padding: 8px 18px;
            border-radius: 40px;
            font-weight: 600;
            color: #1e3c5c;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: 0.2s;
        }
        .month-item.active {
            background: #2e7d32;
            color: white;
        }
        .month-item:hover {
            background: #ffb74d;
        }
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        .info {
            color: #546e7a;
            font-size: 13px;
        }
    </style>
</head>
<body>
<div class="app-container">
    <div class="header">
        <h1>Bumdes</h1>
        <h2>Cipta Mandiri Seganterah</h2>
        <h3>Expenses Management System</h3>
    </div>

    <!-- Pilih Bulan -->
    <div class="month-picker">
        <label>üìÖ Pilih Bulan:</label>
        <select id="bulanSelect">
            <option value="0">Januari</option>
            <option value="1">Februari</option>
            <option value="2">Maret</option>
            <option value="3">April</option>
            <option value="4">Mei</option>
            <option value="5">Juni</option>
            <option value="6">Juli</option>
            <option value="7">Agustus</option>
            <option value="8">September</option>
            <option value="9">Oktober</option>
            <option value="10">November</option>
            <option value="11">Desember</option>
        </select>
    </div>

    <!-- Total Expenses -->
    <div class="total-expenses">
        <span>üí∞ Total Expenses</span>
        <span id="totalBulan">Rp 0</span>
    </div>

    <!-- Container untuk tabel per kategori -->
    <div id="kategoriContainer"></div>

    <!-- Form Tambah/Edit Data -->
    <div class="form-panel">
        <div class="form-title">‚ûï Tambah / Edit Data</div>
        <form id="dataForm" onsubmit="event.preventDefault(); simpanData();">
            <div class="form-grid">
                <div class="form-group">
                    <label>Tanggal</label>
                    <input type="date" id="tanggal" required>
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <select id="kategori" required>
                        <option value="">Pilih Kategori</option>
                        <option value="Gaji karyawan">Gaji karyawan</option>
                        <option value="Pakan">Pakan</option>
                        <option value="Vitamin">Vitamin</option>
                        <option value="Antiseptik">Antiseptik</option>
                        <option value="Komsumsi">Komsumsi</option>
                        <option value="Upah panggul">Upah panggul</option>
                        <option value="Peti">Peti</option>
                        <option value="Admin setor tunai">Admin setor tunai</option>
                        <option value="Listrik kandang">Listrik kandang</option>
                        <option value="Plastik">Plastik</option>
                        <option value="Bubble Wrap">Bubble Wrap</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Deskripsi</label>
                    <input type="text" id="deskripsi" placeholder="Misal: Pakan ayam" required>
                </div>
                <div class="form-group">
                    <label>Pax/Pcs</label>
                    <input type="number" id="pax" min="1" value="1" required>
                </div>
                <div class="form-group">
                    <label>Harga (Rp)</label>
                    <input type="number" id="harga" min="0" step="1000" value="0" required>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn-primary" id="submitBtn">Simpan</button>
                <button type="button" class="btn-secondary" id="resetBtn">Batal</button>
            </div>
            <input type="hidden" id="editId" value="">
        </form>
    </div>

    <!-- Daftar Bulan (navigasi cepat) -->
    <div class="month-list" id="monthList">
        <span class="month-item" data-bulan="0">Jan</span>
        <span class="month-item" data-bulan="1">Feb</span>
        <span class="month-item" data-bulan="2">Mar</span>
        <span class="month-item" data-bulan="3">Apr</span>
        <span class="month-item" data-bulan="4">Mei</span>
        <span class="month-item" data-bulan="5">Jun</span>
        <span class="month-item" data-bulan="6">Jul</span>
        <span class="month-item" data-bulan="7">Agu</span>
        <span class="month-item" data-bulan="8">Sep</span>
        <span class="month-item" data-bulan="9">Okt</span>
        <span class="month-item" data-bulan="10">Nov</span>
        <span class="month-item" data-bulan="11">Des</span>
    </div>

    <!-- Footer dengan tombol cetak -->
    <div class="footer">
        <button class="btn-print" id="btnCetak">üñ®Ô∏è Cetak Data Bulan Ini</button>
        <span class="info">Kategori membantu pengelompokan data</span>
    </div>
</div>

<script>
    (function() {
        // Daftar kategori yang diminta
        const KATEGORI_LIST = [
            "Gaji karyawan",
            "Pakan",
            "Vitamin",
            "Antiseptik",
            "Komsumsi",
            "Upah panggul",
            "Peti",
            "Admin setor tunai",
            "Listrik kandang",
            "Plastik",
            "Bubble Wrap"
        ];

        // Data awal (contoh isian, sesuaikan dengan screenshot dan kategori)
        let dataExpenses = [
            { id: 1, tanggal: '2026-02-02', kategori: 'Pakan', deskripsi: 'Pakan ayam', pax: 30, harga: 365000 },
            { id: 2, tanggal: '2026-02-03', kategori: 'Gaji karyawan', deskripsi: 'Gaji 2 orang', pax: 2, harga: 500000 },
            { id: 3, tanggal: '2026-02-03', kategori: 'Gaji karyawan', deskripsi: 'Gaji mandor', pax: 1, harga: 1000000 },
            { id: 4, tanggal: '2026-02-16', kategori: 'Vitamin', deskripsi: 'Vitamin A', pax: 1, harga: 55000 },
            { id: 5, tanggal: '2026-02-16', kategori: 'Peti', deskripsi: 'Peti kayu', pax: 30, harga: 6000 },
            { id: 6, tanggal: '2026-02-10', kategori: 'Plastik', deskripsi: 'Plastik UK 24', pax: 3, harga: 12000 },
            { id: 7, tanggal: '2026-02-13', kategori: 'Upah panggul', deskripsi: 'Upah bongkar', pax: 1, harga: 10000 },
            { id: 8, tanggal: '2026-02-11', kategori: 'Gaji karyawan', deskripsi: 'Gaji harian', pax: 1, harga: 700000 },
            { id: 9, tanggal: '2026-02-11', kategori: 'Pakan', deskripsi: 'Pakan tambahan', pax: 30, harga: 365000 },
            { id: 10, tanggal: '2026-02-10', kategori: 'Upah panggul', deskripsi: 'Pasang paranet', pax: 2, harga: 25000 },
            { id: 11, tanggal: '2026-02-10', kategori: 'Admin setor tunai', deskripsi: 'Biaya admin', pax: 1, harga: 15000 },
            { id: 12, tanggal: '2026-02-09', kategori: 'Bubble Wrap', deskripsi: 'Bubble wrap', pax: 1, harga: 50450 },
            { id: 13, tanggal: '2026-02-09', kategori: 'Vitamin', deskripsi: 'Vitamin B', pax: 1, harga: 56000 },
            { id: 14, tanggal: '2026-02-07', kategori: 'Peti', deskripsi: 'Peti kecil', pax: 2, harga: 15000 },
            { id: 15, tanggal: '2026-02-04', kategori: 'Peti', deskripsi: 'Peti besar', pax: 3, harga: 15000 },
            { id: 16, tanggal: '2026-02-05', kategori: 'Listrik kandang', deskripsi: 'Token listrik', pax: 1, harga: 200000 },
            { id: 17, tanggal: '2026-02-06', kategori: 'Komsumsi', deskripsi: 'Makan karyawan', pax: 5, harga: 25000 },
            { id: 18, tanggal: '2026-02-12', kategori: 'Antiseptik', deskripsi: 'Desinfektan', pax: 2, harga: 75000 },
        ];

        // Helper format rupiah
        function formatRupiah(angka) {
            return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        // Mendapatkan bulan dan tahun dari tanggal ISO
        function getMonthFromDate(tanggal) {
            return new Date(tanggal + 'T12:00:00').getMonth(); // angka 0-11
        }

        // Render semua tabel berdasarkan bulan yang dipilih
        function renderBulan(bulanIndex) {
            const container = document.getElementById('kategoriContainer');
            container.innerHTML = '';

            // Filter data berdasarkan bulan (bulanIndex adalah angka 0-11)
            const dataBulan = dataExpenses.filter(item => getMonthFromDate(item.tanggal) === bulanIndex);

            // Hitung total seluruh bulan
            const totalBulan = dataBulan.reduce((sum, item) => sum + (item.pax * item.harga), 0);
            document.getElementById('totalBulan').innerText = formatRupiah(totalBulan);

            // Untuk setiap kategori, buat section tabel
            KATEGORI_LIST.forEach(kategori => {
                const dataKategori = dataBulan.filter(item => item.kategori === kategori);
                // Urutkan berdasarkan tanggal descending
                dataKategori.sort((a,b) => new Date(b.tanggal) - new Date(a.tanggal));

                // Buat elemen section
                const section = document.createElement('div');
                section.className = 'kategori-section';

                // Hitung total per kategori
                const totalKategori = dataKategori.reduce((sum, item) => sum + (item.pax * item.harga), 0);

                // Header kategori
                const header = document.createElement('div');
                header.className = 'kategori-header';
                header.innerHTML = `
                    <span>${kategori}</span>
                    <span class="kategori-total">${formatRupiah(totalKategori)}</span>
                `;
                section.appendChild(header);

                // Tabel
                const tableWrapper = document.createElement('div');
                tableWrapper.className = 'table-wrapper';
                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>NO</th>
                            <th>TANGGAL</th>
                            <th>DESKRIPSI</th>
                            <th>PAX/PCS</th>
                            <th>HARGA</th>
                            <th>JUMLAH</th>
                            <th>AKSI</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-${kategori.replace(/\s/g,'')}">
                    </tbody>
                `;
                tableWrapper.appendChild(table);
                section.appendChild(tableWrapper);
                container.appendChild(section);

                const tbody = document.getElementById(`tbody-${kategori.replace(/\s/g,'')}`);
                if (dataKategori.length === 0) {
                    const row = document.createElement('tr');
                    row.className = 'empty-row';
                    row.innerHTML = '<td colspan="7">Belum ada data untuk kategori ini</td>';
                    tbody.appendChild(row);
                } else {
                    dataKategori.forEach((item, idx) => {
                        const row = document.createElement('tr');
                        const jumlah = item.pax * item.harga;
                        row.innerHTML = `
                            <td>${idx + 1}</td>
                            <td>${new Date(item.tanggal).toLocaleDateString('id-ID', { day:'2-digit', month:'short', year:'numeric' })}</td>
                            <td>${item.deskripsi}</td>
                            <td>${item.pax}</td>
                            <td>${formatRupiah(item.harga)}</td>
                            <td>${formatRupiah(jumlah)}</td>
                            <td class="aksi-btn">
                                <button class="btn-edit" onclick="editData(${item.id})">Edit</button>
                                <button class="btn-hapus" onclick="hapusData(${item.id})">Hapus</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            });
        }

        // Inisialisasi bulan aktif (default Februari = 1)
        let bulanAktif = 1; // Februari

        // Set dropdown dan bulan list aktif
        function setBulanAktif(bulan) {
            bulanAktif = bulan;
            document.getElementById('bulanSelect').value = bulan;
            // Update class active di month list
            document.querySelectorAll('.month-item').forEach(el => {
                const val = parseInt(el.dataset.bulan);
                if (val === bulan) el.classList.add('active');
                else el.classList.remove('active');
            });
            renderBulan(bulan);
        }

        // Event listener dropdown
        document.getElementById('bulanSelect').addEventListener('change', function(e) {
            setBulanAktif(parseInt(e.target.value));
        });

        // Event listener month list
        document.querySelectorAll('.month-item').forEach(el => {
            el.addEventListener('click', function() {
                const bulan = parseInt(this.dataset.bulan);
                setBulanAktif(bulan);
            });
        });

        // Fungsi simpan data (tambah/edit)
        window.simpanData = function() {
            const tanggal = document.getElementById('tanggal').value;
            const kategori = document.getElementById('kategori').value;
            const deskripsi = document.getElementById('deskripsi').value.trim();
            const pax = parseInt(document.getElementById('pax').value);
            const harga = parseInt(document.getElementById('harga').value);
            const editId = document.getElementById('editId').value;

            if (!tanggal || !kategori || !deskripsi || !pax || !harga) {
                alert('Semua field wajib diisi!');
                return;
            }

            if (editId) {
                // Update
                const index = dataExpenses.findIndex(d => d.id == editId);
                if (index !== -1) {
                    dataExpenses[index] = { ...dataExpenses[index], tanggal, kategori, deskripsi, pax, harga };
                }
            } else {
                // Tambah baru
                const newId = dataExpenses.length ? Math.max(...dataExpenses.map(d => d.id)) + 1 : 1;
                dataExpenses.push({ id: newId, tanggal, kategori, deskripsi, pax, harga });
            }

            // Reset form
            resetForm();
            // Render ulang bulan yang aktif
            renderBulan(bulanAktif);
        };

        window.editData = function(id) {
            const item = dataExpenses.find(d => d.id === id);
            if (!item) return;

            document.getElementById('tanggal').value = item.tanggal;
            document.getElementById('kategori').value = item.kategori;
            document.getElementById('deskripsi').value = item.deskripsi;
            document.getElementById('pax').value = item.pax;
            document.getElementById('harga').value = item.harga;
            document.getElementById('editId').value = item.id;
            document.getElementById('submitBtn').innerText = 'Update';

            // Scroll ke form
            document.querySelector('.form-panel').scrollIntoView({ behavior: 'smooth' });
        };

        window.hapusData = function(id) {
            if (confirm('Yakin ingin menghapus data ini?')) {
                dataExpenses = dataExpenses.filter(d => d.id !== id);
                renderBulan(bulanAktif);
                // Jika yang diedit adalah data yang dihapus, reset form
                if (document.getElementById('editId').value == id) {
                    resetForm();
                }
            }
        };

        function resetForm() {
            document.getElementById('tanggal').value = '';
            document.getElementById('kategori').value = '';
            document.getElementById('deskripsi').value = '';
            document.getElementById('pax').value = '1';
            document.getElementById('harga').value = '0';
            document.getElementById('editId').value = '';
            document.getElementById('submitBtn').innerText = 'Simpan';
        }

        document.getElementById('resetBtn').addEventListener('click', resetForm);

        // Cetak data (hanya laporan bulan ini)
        document.getElementById('btnCetak').addEventListener('click', function() {
            window.print();
        });

        // Set default tanggal hari ini
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('tanggal').value = today;

        // Inisialisasi tampilan dengan bulan Februari (1)
        setBulanAktif(1);
    })();
</script>
</body>
</html>